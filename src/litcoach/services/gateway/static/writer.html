<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Writer | Literacy Coach</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            body { font-family: system-ui, sans-serif; margin: 24px; line-height: 1.5; }
            textarea { width: 100%; height: 140px; }
            input, select { width: 100%; padding: 8px; margin: 6px 0; }
            button { padding: 10px 16px; margin-top: 6px; }
            .result { white-space: pre-wrap; background: #fafafa; border: 1px solid #eee; padding: 12px; }
            .nav { margin-bottom: 16px; }
        </style>
    </head>
    <body>
        <div class="nav"><a href="/">Home</a> | <a href="/reader.html">Reader</a> | <a href="/teacher.html">Teacher Dashboard</a></div>
        <h1>Writer</h1>
        <label>Prompt</label>
        <textarea id="prompt">Describe a memorable place and explain why it matters to you.</textarea>
        <label>Essay</label>
        <textarea id="essay"></textarea>
        <label>Grade Level</label>
        <select id="grade">
            <option>5</option>
            <option>7</option>
            <option>9</option>
        </select>
        <label>Class ID (optional)</label>
        <input id="classId" />
        <label>Assignment ID (optional)</label>
        <input id="assignmentId" />
        <button id="feedbackBtn">Get Coaching</button>
        <button id="scoreBtn">Score with Rubric</button>
        <div class="result" id="result"></div>

        <script>
            const result = document.getElementById('result');
            const grade = document.getElementById('grade');
            const essay = document.getElementById('essay');
            const promptEl = document.getElementById('prompt');
            const classId = document.getElementById('classId');
            const assignmentId = document.getElementById('assignmentId');

            document.getElementById('feedbackBtn').onclick = async () => {
                const messages = [
                    { role: "user", content: `Writing request\nPrompt:\n${promptEl.value}\nEssay:\n${essay.value}` }
                ];
                const payload = { messages, mode: "tutor", student_grade: grade.value };
                const resp = await fetch('/agent/respond', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!resp.ok) {
                    result.textContent = "Error: " + resp.statusText;
                    return;
                }
                const data = await resp.json();
                result.textContent = data.content;
            };

            document.getElementById('scoreBtn').onclick = async () => {
                const payload = {
                    user_id: "writer",
                    class_id: classId.value || null,
                    assignment_id: assignmentId.value || null,
                    prompt: promptEl.value,
                    essay: essay.value,
                    grade_level: grade.value,
                    rubric_name: "writing_default"
                };
                const resp = await fetch('/api/writing/score', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!resp.ok) {
                    result.textContent = "Error: " + resp.statusText;
                    return;
                }
                const data = await resp.json();
                result.textContent = "Scores: " + JSON.stringify(data.rubric_scores) + "\nFeedback: " + data.feedback;
            };
        </script>
    </body>
</html>


